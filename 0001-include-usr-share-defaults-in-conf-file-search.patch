From 3936b77f7746c1e687d9b651b613255de4deb6d8 Mon Sep 17 00:00:00 2001
From: Jose Lamego <jose.a.lamego@intel.com>
Date: Fri, 10 Aug 2018 10:21:06 -0500
Subject: [PATCH] include /usr/share/defaults in conf file search

crio conf file may not be present in default /etc/crio directory.
This change includes looking in /usr/share/defaults/crio if
not found in default location.

Signed-off-by: Jose Lamego <jose.a.lamego@intel.com>
---
 cmd/crio/main.go | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/cmd/crio/main.go b/cmd/crio/main.go
index 6f8d13b..9a7ad4a 100644
--- a/cmd/crio/main.go
+++ b/cmd/crio/main.go
@@ -37,6 +37,10 @@ import (
 // It will be populated by the Makefile.
 var gitCommit = ""
 
+// statelessConfigFile is the path to default configuration file in
+// stateless systems
+var statelessConfigFile = "/usr/share/defaults/crio/crio.conf"
+
 var deprecatedRuntimeMsg = `
 /*\ Warning /*\
 DEPRECATED: Use Runtimes instead.
@@ -125,6 +129,12 @@ func mergeConfig(config *server.Config, ctx *cli.Context) error {
 			// default doesn't exist. But we will log a warning about it, so
 			// the user doesn't miss it.
 			logrus.Warnf("default configuration file does not exist: %s", server.CrioConfigPath)
+			logrus.Warnf("attempting to load configuration file from stateles directory: %s", statelessConfigFile)
+			if err := config.UpdateFromFile(statelessConfigFile); err != nil {
+				if ctx.GlobalIsSet("config") || os.IsNotExist(err) {
+					logrus.Warnf("configuration file at stateles directory does not exist: %s", statelessConfigFile)
+				}
+			}
 		}
 	}
 
-- 
2.19.1

