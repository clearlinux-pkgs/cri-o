From 3ebd20ca494cb2193740e8cc0ca34496f380789e Mon Sep 17 00:00:00 2001
From: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
Date: Sun, 31 Mar 2019 19:50:52 +0000
Subject: [PATCH 1/5] include /usr/share/defaults in conf file search

crio conf file may not be present in default /etc/crio directory.
This change includes looking in /usr/share/defaults/crio if
not found in default location.

Signed-off-by: Jose Lamego <jose.a.lamego@intel.com>
Signed-off-by: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
---
 cmd/crio/main.go | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/cmd/crio/main.go b/cmd/crio/main.go
index a2595df..0c93efc 100644
--- a/cmd/crio/main.go
+++ b/cmd/crio/main.go
@@ -34,6 +34,10 @@ import (
 // It will be populated by the Makefile.
 var gitCommit = ""
 
+// statelessConfigFile is the path to default configuration file in
+// stateless systems
+var statelessConfigFile = "/usr/share/defaults/crio/crio.conf"
+
 // DefaultsPath is the path to default configuration files set at build time
 var DefaultsPath string
 
@@ -59,6 +63,12 @@ func mergeConfig(config *server.Config, ctx *cli.Context) error {
 			// default doesn't exist. But we will log a warning about it, so
 			// the user doesn't miss it.
 			logrus.Warnf("default configuration file does not exist: %s", path)
+			logrus.Warnf("attempting to load configuration file from stateles directory: %s", statelessConfigFile)
+			if err := config.UpdateFromFile(statelessConfigFile); err != nil {
+				if ctx.GlobalIsSet("config") || os.IsNotExist(err) {
+					logrus.Warnf("configuration file at stateles directory does not exist: %s", statelessConfigFile)
+				}
+			}
 		}
 	}
 
-- 
2.21.0

