From dfd1a2609ffd4ae01ccf9ddb8cff83325e8767ce Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Thu, 4 Oct 2018 17:05:03 -0500
Subject: [PATCH 3/6] Update default crio.conf file for Clear Linux

Update paths to policy.json, seccomp.json, conmon and cni plugins
to reflect where they are intended to be used from Clear Linux.
Add docker.io as image registry. Set overlay as default storage
driver.

Signed-off-by: Jose Lamego <jose.a.lamego@intel.com>
---
 Makefile | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/Makefile b/Makefile
index df46b63..4218639 100644
--- a/Makefile
+++ b/Makefile
@@ -108,6 +108,13 @@ bin/crio: .gopathok
 
 crio.conf: bin/crio
 	./bin/crio --config="" config --default > crio.conf
+	sed -i 's|^\(conmon = \).*|\1"/usr/libexec/crio/conmon"|' crio.conf
+	sed -i 's|^\(seccomp_profile = \).*|\1"/usr/share/defaults/crio/seccomp.json"|' crio.conf
+	sed -i "s|^#\(registries = \[\).*|\1\n\t'docker.io',\n\]|" crio.conf
+	sed -i 's|^\(signature_policy = \).*|\1"/usr/share/defaults/crio/policy.json"|' crio.conf
+	sed -i 's|^#\(storage_driver = \).*|\1"overlay"|' crio.conf
+	sed -i 's|^\(plugin_dirs = \[\).*|\1\n\t"/usr/libexec/cni",|' crio.conf
+	sed -i 's|^\(cgroup_manager = \).*|\1"systemd"|' crio.conf
 
 release-note:
 	@$(GOPATH)/bin/release-tool -n $(release)
-- 
2.22.0

