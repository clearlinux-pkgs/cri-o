From e024ed0d2779b76e81bafc22bc08643f77374300 Mon Sep 17 00:00:00 2001
From: William Douglas <william.douglas@intel.com>
Date: Thu, 4 Oct 2018 17:05:03 -0500
Subject: [PATCH 3/5] Update default crio.conf file for Clear Linux

Update paths to policy.json, seccomp.json, conmon and cni plugins
to reflect where they are intended to be used from Clear Linux.
Add docker.io as image registry. Set overlay as default storage
driver.

Signed-off-by: Jose Lamego <jose.a.lamego@intel.com>
---
 Makefile | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/Makefile b/Makefile
index b200b49..2e9fc66 100644
--- a/Makefile
+++ b/Makefile
@@ -108,6 +108,12 @@ bin/crio: .gopathok
 
 crio.conf: bin/crio
 	./bin/crio --config="" config --default > crio.conf
+	sed -i 's|^#\(default_ulimits = \[\)|\1\n\t"nofile=65536:65536"\n\]|' crio.conf
+	sed -i 's|^\(conmon = \).*|\1"/usr/libexec/crio/conmon"|' crio.conf
+	sed -i 's|^\(seccomp_profile = \).*|\1"/usr/share/defaults/crio/seccomp.json"|' crio.conf
+	sed -i "s|^#\(registries = \[\).*|\1\n\t'docker.io',\n\]|" crio.conf
+	sed -i 's|^\(signature_policy = \).*|\1"/usr/share/defaults/crio/policy.json"|' crio.conf
+	sed -i 's|^#\(storage_driver = \).*|\1"overlay"|' crio.conf
 
 release-note:
 	@$(GOPATH)/bin/release-tool -n $(release)
-- 
2.21.0

